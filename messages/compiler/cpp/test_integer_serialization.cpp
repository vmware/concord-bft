void test_integer_serialization() {
  auto test = [](const auto &input, std::vector<std::uint8_t> expected) {
    auto output = std::vector<std::uint8_t>{};
    serialize(output, input);
    assert(output == expected);
  };

  // Unsigned
  test(Uint8{0xad}, {0xad});
  test(Uint16{0xa85e}, {0xa8, 0x5e});
  test(Uint32{0xf301bc56}, {0xf3, 0x01, 0xbc, 0x56});
  test(Uint64{0x1070cdabffef4376}, {0x10, 0x70, 0xcd, 0xab, 0xff, 0xef, 0x43, 0x76});

  // Signed positive
  test(Int8{23}, {0x17});
  test(Int16{999}, {0x03, 0xe7});
  test(Int32{250000}, {0x00, 0x03, 0xd0, 0x90});
  test(Int64{10000000}, {0x00, 0x00, 0x00, 0x00, 0x00, 0x98, 0x96, 0x80});

  // Signed negative
  test(Int8{-5}, {0xfb});
  test(Int16{-127}, {0xff, 0x81});
  test(Int32{-10820}, {0xff, 0xff, 0xd5, 0xbc});
  test(Int64{-15}, {0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf1});
}
